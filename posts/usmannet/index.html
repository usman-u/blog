<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>UsmanNet 2022 - An Overview of my Network | Usman</title><meta name=keywords content><meta name=description content="Logical Overview Network Infrastructure Breakdown: My network mainly consists of two Ubiquiti EdgeRouter Xs, two Cisco Catalyst switches, and cloud VPSs.
WireGuard is used as the VPN tunneling protocol, to connect sites and VPS Instances.
DN42 BGP: I&rsquo;m a member of the DN42 BGP project.
fr-lil1, uk-lon1, us-west1 act as the eBGP edge routers, peering peering with various providers, and allowing access the to the DN42 private network. iBGP between fr-lil1, uk-lon1 & us-west1 (exchanging only external DN42 BGP routes)."><meta name=author content="Usman"><link rel=canonical href=https://blog.usman.network/posts/usmannet/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.usman.network/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.usman.network/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.usman.network/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.usman.network/apple-touch-icon.png><link rel=mask-icon href=https://blog.usman.network/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-KWB2M6CZK2"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-KWB2M6CZK2",{anonymize_ip:!1})}</script><meta property="og:title" content="UsmanNet 2022 - An Overview of my Network"><meta property="og:description" content="Logical Overview Network Infrastructure Breakdown: My network mainly consists of two Ubiquiti EdgeRouter Xs, two Cisco Catalyst switches, and cloud VPSs.
WireGuard is used as the VPN tunneling protocol, to connect sites and VPS Instances.
DN42 BGP: I&rsquo;m a member of the DN42 BGP project.
fr-lil1, uk-lon1, us-west1 act as the eBGP edge routers, peering peering with various providers, and allowing access the to the DN42 private network. iBGP between fr-lil1, uk-lon1 & us-west1 (exchanging only external DN42 BGP routes)."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.usman.network/posts/usmannet/"><meta property="og:image" content="https://blog.usman.network/images/hn/cables.PNG"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-07-28T20:29:16+01:00"><meta property="article:modified_time" content="2022-07-28T20:29:16+01:00"><meta property="og:site_name" content="Usman"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.usman.network/images/hn/cables.PNG"><meta name=twitter:title content="UsmanNet 2022 - An Overview of my Network"><meta name=twitter:description content="Logical Overview Network Infrastructure Breakdown: My network mainly consists of two Ubiquiti EdgeRouter Xs, two Cisco Catalyst switches, and cloud VPSs.
WireGuard is used as the VPN tunneling protocol, to connect sites and VPS Instances.
DN42 BGP: I&rsquo;m a member of the DN42 BGP project.
fr-lil1, uk-lon1, us-west1 act as the eBGP edge routers, peering peering with various providers, and allowing access the to the DN42 private network. iBGP between fr-lil1, uk-lon1 & us-west1 (exchanging only external DN42 BGP routes)."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.usman.network/posts/"},{"@type":"ListItem","position":2,"name":"UsmanNet 2022 - An Overview of my Network","item":"https://blog.usman.network/posts/usmannet/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"UsmanNet 2022 - An Overview of my Network","name":"UsmanNet 2022 - An Overview of my Network","description":"Logical Overview Network Infrastructure Breakdown: My network mainly consists of two Ubiquiti EdgeRouter Xs, two Cisco Catalyst switches, and cloud VPSs.\nWireGuard is used as the VPN tunneling protocol, to connect sites and VPS Instances.\nDN42 BGP: I\u0026rsquo;m a member of the DN42 BGP project.\nfr-lil1, uk-lon1, us-west1 act as the eBGP edge routers, peering peering with various providers, and allowing access the to the DN42 private network. iBGP between fr-lil1, uk-lon1 \u0026amp; us-west1 (exchanging only external DN42 BGP routes).","keywords":[],"articleBody":"Logical Overview Network Infrastructure Breakdown: My network mainly consists of two Ubiquiti EdgeRouter Xs, two Cisco Catalyst switches, and cloud VPSs.\nWireGuard is used as the VPN tunneling protocol, to connect sites and VPS Instances.\nDN42 BGP: I’m a member of the DN42 BGP project.\nfr-lil1, uk-lon1, us-west1 act as the eBGP edge routers, peering peering with various providers, and allowing access the to the DN42 private network. iBGP between fr-lil1, uk-lon1 \u0026 us-west1 (exchanging only external DN42 BGP routes). Prefixes from eBGP peers are filtered using RPKI-ROA (docker), such that invalid prefixed are removed. See my other post for more info. OSPF:\nOSPF area 0 between erx.usman \u0026 fr-lil1 (advertising only internal routes). fr-lil1 is the OSPF ABR. OSPF area 1 between fr-lil1, uk-lon1 \u0026 us-west1. Using MultiArea OSPF, so that a full DN42 BGP route table isn’t redistributed into OSPF. 172.20.0.0/14 is summarised into area 0, at the OSPF ABR (fr-lil1). Source NAT on erx.usman such that traffic destined for DN42 services (172.20.0.0/14), is translated into a DN42 IP (from my range).\nAuthoritative DNS records (for the .lan TLD) are running on pi.usman.lan \u0026 plex.usman.lan, as Unbound Docker Containers.\nPartly deployed using Drone CI/CD and my own Python Configuration Management Framework.\nSee github.com/usman-u/network-automation and github.com/usman-u/usmannet for more info.\nLibreNMS Weathermap Click here to see a live version of the weathermap.\nMore Info: My Home LAN Ubiquiti Edgerouter X - erx.usman.lan\nWireGuard VPNs to and dn42-vps.lan. OSPF area 1 neighbors with and dn42-vps.lan. Source NAT on VPN interfaces, such that any outbound traffic destined for DN42, is NATed to a DN42 IP. Router-On-A-Stick VLANs - with a VLAN trunk down to the Cisco 2960G. Cisco 2960G - usman-cisco.lan\nBasic Layer 2 switching to normal end user hosts. Raspberry Pi 4 8GB - pi.usman.lan\nSome of the Docker Applications I host: BIND9 DNS Server DNS A and PTR records, for the .usman.network. domain. Plex Media Server Radarr, Sonarr, Jackett, qBittorrent. Syncthing. NGINX Proxy Manager - routes a few of the mentioned services through Cloudfare’s WAF, for DDOS mitigation and public IP obfuscation. WD 8TB NAS - nas.usman.lan\nSMB Shares. Plex Media Server My DN42 Nodes My DN42 nodes are hosted on cloud infrastructure. See my DN42 peering page for more info. ","wordCount":"371","inLanguage":"en","image":"https://blog.usman.network/images/hn/cables.PNG","datePublished":"2022-07-28T20:29:16+01:00","dateModified":"2022-07-28T20:29:16+01:00","author":{"@type":"Person","name":"Usman"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.usman.network/posts/usmannet/"},"publisher":{"@type":"Organization","name":"Usman","logo":{"@type":"ImageObject","url":"https://blog.usman.network/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.usman.network/ accesskey=h title="Usman (Alt + H)">Usman</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.usman.network/dn42/ title="DN42 Peering"><span>DN42 Peering</span></a></li><li><a href=https://blog.usman.network/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://blog.usman.network/contact/ title=Contact><span>Contact</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://blog.usman.network/>Home</a>&nbsp;»&nbsp;<a href=https://blog.usman.network/posts/>Posts</a></div><h1 class=post-title>UsmanNet 2022 - An Overview of my Network</h1><div class=post-meta><span title='2022-07-28 20:29:16 +0100 +0100'>28 July, 2022</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Usman</div></header><figure class=entry-cover><img loading=lazy src=https://blog.usman.network/images/hn/cables.PNG alt=alt></figure><div class=post-content><h3 id=logical-overview>Logical Overview<a hidden class=anchor aria-hidden=true href=#logical-overview>#</a></h3><p><img loading=lazy src=/images/hn/net_map.png alt=" Diagram"></p><hr><h2 id=network-infrastructure-breakdown>Network Infrastructure Breakdown:<a hidden class=anchor aria-hidden=true href=#network-infrastructure-breakdown>#</a></h2><ul><li><p>My network mainly consists of two Ubiquiti EdgeRouter Xs, two Cisco Catalyst switches, and cloud VPSs.</p></li><li><p>WireGuard is used as the VPN tunneling protocol, to connect sites and VPS Instances.</p></li><li><p>DN42 BGP: I&rsquo;m a member of the <a href=https://dn42.eu>DN42 BGP project</a>.</p><ul><li><strong>fr-lil1</strong>, <strong>uk-lon1</strong>, <strong>us-west1</strong> act as the eBGP edge routers, peering peering with various providers, and allowing access the to the DN42 private network.</li><li>iBGP between <strong>fr-lil1</strong>, <strong>uk-lon1</strong> & <strong>us-west1</strong> (exchanging only external DN42 BGP routes).</li><li>Prefixes from eBGP peers are filtered using RPKI-ROA (docker), such that invalid prefixed are removed. See my <a href=./bgp-rpki-roa>other post</a> for more info.</li></ul></li><li><p>OSPF:</p><ul><li>OSPF area 0 between <strong>erx.usman</strong> & <strong>fr-lil1</strong> (advertising only internal routes).</li><li><strong>fr-lil1</strong> is the OSPF ABR.</li><li>OSPF area 1 between <strong>fr-lil1</strong>, <strong>uk-lon1</strong> & <strong>us-west1</strong>.</li><li>Using MultiArea OSPF, so that a full DN42 BGP route table isn&rsquo;t redistributed into OSPF.</li><li><strong>172.20.0.0/14</strong> is summarised into area 0, at the OSPF ABR (fr-lil1).</li></ul></li><li><p>Source NAT on <strong>erx.usman</strong> such that traffic destined for DN42 services (<strong>172.20.0.0/14</strong>), is translated into a DN42 IP (from my range).</p></li><li><p>Authoritative DNS records (for the <strong>.lan</strong> TLD) are running on <strong>pi.usman.lan</strong> & <strong>plex.usman.lan</strong>, as Unbound Docker Containers.</p></li><li><p>Partly deployed using Drone CI/CD and my own Python Configuration Management Framework.</p></li><li><p>See <a href=https://github.com/usman-u/network-automation>github.com/usman-u/network-automation</a> and <a href=github.com/usman-u/usmannet>github.com/usman-u/usmannet</a> for more info.</p></li></ul><hr><h3 id=librenms-weathermap>LibreNMS Weathermap<a hidden class=anchor aria-hidden=true href=#librenms-weathermap>#</a></h3><p><img loading=lazy src=/images/hn/weathermap.png alt=" Diagram"></p><p><a href=https://libre.usman.network/plugins/Weathermap/test.html>Click here</a> to see a live version of the weathermap.</p><hr><h2 id=more-info>More Info:<a hidden class=anchor aria-hidden=true href=#more-info>#</a></h2><hr><h3 id=my-home-lan>My Home LAN<a hidden class=anchor aria-hidden=true href=#my-home-lan>#</a></h3><ul><li><p>Ubiquiti Edgerouter X - <strong>erx.usman.lan</strong></p><ul><li>WireGuard VPNs to and <strong>dn42-vps.lan</strong>.</li><li>OSPF area 1 neighbors with and <strong>dn42-vps.lan</strong>.</li><li>Source NAT on VPN interfaces, such that any outbound traffic destined for DN42, is NATed to a DN42 IP.</li><li><em>Router-On-A-Stick</em> VLANs - with a VLAN trunk down to the Cisco 2960G.</li></ul></li><li><p>Cisco 2960G - <strong>usman-cisco.lan</strong></p><ul><li>Basic Layer 2 switching to normal end user hosts.</li></ul></li><li><p>Raspberry Pi 4 8GB - <strong>pi.usman.lan</strong></p><ul><li>Some of the Docker Applications I host:<ul><li><a href=https://wiki.debian.org/Bind9>BIND9 DNS Server</a> DNS A and PTR records, for the <strong>.usman.network.</strong> domain.</li><li><a href=https://docs.linuxserver.io/images/docker-plex>Plex Media Server</a></li><li><a href=https://radarr.video/>Radarr</a>, <a href=https://sonarr.tv/>Sonarr</a>, <a href=https://github.com/Jackett/Jackett>Jackett</a>, <a href=https://hub.docker.com/r/linuxserver/qbittorrent>qBittorrent</a>.</li><li><a href=https://syncthing.net/>Syncthing</a>.</li><li><a href=https://nginxproxymanager.com/>NGINX Proxy Manager</a> - routes a few of the mentioned services through <a href=https://www.cloudflare.com/en-gb/waf/>Cloudfare&rsquo;s WAF</a>, for DDOS mitigation and public IP obfuscation.</li></ul></li></ul></li><li><p>WD 8TB NAS - <strong>nas.usman.lan</strong></p><ul><li>SMB Shares.</li><li>Plex Media Server</li></ul></li></ul><hr><h3 id=my-dn42-nodes>My DN42 Nodes<a hidden class=anchor aria-hidden=true href=#my-dn42-nodes>#</a></h3><ul><li>My DN42 nodes are hosted on cloud infrastructure.</li><li>See <a href=../../dn42>my DN42 peering page</a> for more info.</li></ul><hr></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=next href=https://blog.usman.network/posts/bgp-rpki-roa/><span class=title>Next »</span><br><span>DN42 Part 3: BGP ROA/RPKI Filtering using Docker</span></a></nav></footer><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//blog-usman-network.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2023 <a href=https://blog.usman.network/>Usman</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script>const images=Array.from(document.querySelectorAll(".post-content img"));images.forEach(e=>{mediumZoom(e,{margin:0,scrollOffset:40,container:null,template:null})})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>